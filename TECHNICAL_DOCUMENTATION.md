# üìñ Documentation Technique - Base de Jurisprudence IA

## Table des Mati√®res

1. [Architecture Syst√®me](#architecture-syst√®me)
2. [Structure du Projet](#structure-du-projet)
3. [Base de Donn√©es](#base-de-donn√©es)
4. [API REST](#api-rest)
5. [Services](#services)
6. [S√©curit√©](#s√©curit√©)
7. [Performance](#performance)
8. [Tests](#tests)

## Architecture Syst√®me

### Vue d'Ensemble

L'application suit une architecture **MVC (Model-View-Controller)** adapt√©e pour Flask :

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Client    ‚îÇ ‚Üê Frontend (HTML/CSS/JS)
‚îÇ   Browser   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ HTTP/HTTPS
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Nginx     ‚îÇ ‚Üê Reverse Proxy (Production)
‚îÇ   (Optional)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Gunicorn   ‚îÇ ‚Üê WSGI Server
‚îÇ   Workers   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    Flask    ‚îÇ ‚Üê Application Web
‚îÇ     App     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Services (AI, PDF, Encryption)
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Routes (API Endpoints)
       ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Models (SQLAlchemy)
                        ‚îÇ
                        ‚ñº
                   PostgreSQL
```

### Flux de Donn√©es

1. **Requ√™te entrante** ‚Üí Nginx (si configur√©) ‚Üí Gunicorn ‚Üí Flask
2. **Authentification** ‚Üí Flask-Login v√©rifie la session
3. **Autorisation** ‚Üí D√©corateurs v√©rifient les permissions
4. **Traitement** ‚Üí Route appelle un service si n√©cessaire
5. **Base de donn√©es** ‚Üí SQLAlchemy ORM g√®re les requ√™tes
6. **R√©ponse** ‚Üí JSON ou template HTML rendu

## Structure du Projet

### Arborescence D√©taill√©e

```
jurisprudence-platform/
‚îÇ
‚îú‚îÄ‚îÄ backend/                        # Code serveur
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ app.py                     # Point d'entr√©e Flask
‚îÇ   ‚îú‚îÄ‚îÄ config.py                  # Configuration centrale
‚îÇ   ‚îú‚îÄ‚îÄ init_roles.py              # Initialisation r√¥les
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ models/                    # Mod√®les de donn√©es
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py               # Mod√®le User + db
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ case.py               # Mod√®le JurisprudenceCase
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ role.py               # Mod√®le Role + Permission
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ routes/                    # Contr√¥leurs API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py               # /api/auth/* endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cases.py              # /api/cases/* endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ batch_import.py       # /api/batch-import/* endpoints
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ roles.py              # /api/roles/* endpoints
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/                  # Logique m√©tier
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai_service.py         # Service OpenRouter
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pdf_extractor.py     # Service extraction PDF
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ utils/                     # Utilitaires
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ encryption.py         # Chiffrement Fernet
‚îÇ       ‚îú‚îÄ‚îÄ text_cleaner.py       # Nettoyage texte
‚îÇ       ‚îî‚îÄ‚îÄ secrets_checker.py    # V√©rification secrets
‚îÇ
‚îú‚îÄ‚îÄ frontend/                       # Interface utilisateur
‚îÇ   ‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ moa-design.css   # Design system complet
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ login.js
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ register.js
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ dashboard.js
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ search.js
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ cases.js
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ admin_new.js
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ admin_roles.js
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ templates/                 # Templates Jinja2
‚îÇ       ‚îú‚îÄ‚îÄ login.html
‚îÇ       ‚îú‚îÄ‚îÄ register.html
‚îÇ       ‚îú‚îÄ‚îÄ dashboard.html
‚îÇ       ‚îú‚îÄ‚îÄ search.html
‚îÇ       ‚îú‚îÄ‚îÄ cases.html
‚îÇ       ‚îú‚îÄ‚îÄ case_detail.html
‚îÇ       ‚îú‚îÄ‚îÄ admin_new.html
‚îÇ       ‚îî‚îÄ‚îÄ admin_roles.html
‚îÇ
‚îú‚îÄ‚îÄ uploads/                        # Fichiers upload√©s
‚îÇ   ‚îî‚îÄ‚îÄ pdfs/                      # PDFs import√©s
‚îÇ       ‚îú‚îÄ‚îÄ single/                # Imports uniques
‚îÇ       ‚îî‚îÄ‚îÄ batch_*/               # Imports en masse
‚îÇ
‚îú‚îÄ‚îÄ main.py                         # Point d'entr√©e principal
‚îú‚îÄ‚îÄ requirements.txt                # D√©pendances Python
‚îú‚îÄ‚îÄ pyproject.toml                  # Configuration projet
‚îú‚îÄ‚îÄ README.md                       # Documentation utilisateur
‚îú‚îÄ‚îÄ TECHNICAL_DOCUMENTATION.md      # Ce fichier
‚îî‚îÄ‚îÄ DEPLOYMENT.md                   # Guide d√©ploiement
```

### Responsabilit√©s des Modules

#### backend/app.py
- Initialisation de l'application Flask
- Configuration des extensions (CORS, CSRF, Login)
- Enregistrement des blueprints
- Gestion du cache HTTP
- Routes de rendu de templates
- Cr√©ation automatique de la base de donn√©es
- Initialisation des r√¥les syst√®me
- Cr√©ation du compte admin par d√©faut

#### backend/config.py
```python
class Config:
    SECRET_KEY: str                 # Cl√© session Flask
    DATABASE_URL: str               # URL PostgreSQL
    SQLALCHEMY_TRACK_MODIFICATIONS: bool = False
    ENCRYPTION_KEY: bytes           # Cl√© Fernet
    OPENROUTER_API_KEY: str         # Cl√© API OpenRouter
    OPENROUTER_API_URL: str         # URL API OpenRouter
```

#### backend/models/
- **user.py**: Mod√®le User avec attributs, relations, m√©thodes
- **case.py**: Mod√®le JurisprudenceCase avec champs chiffr√©s
- **role.py**: Mod√®le Role et Permission avec JSON

#### backend/routes/
- **auth.py**: 8 endpoints d'authentification et gestion utilisateurs
- **cases.py**: 7 endpoints de gestion de jurisprudence + recherche IA
- **batch_import.py**: 2 endpoints d'import PDF (masse + simple)
- **roles.py**: 4 endpoints CRUD pour r√¥les et permissions

#### backend/services/
- **ai_service.py**: 
  - `find_similar_cases()`: recherche synchrone
  - `find_similar_cases_streaming()`: recherche avec SSE
- **pdf_extractor.py**:
  - `extract_case_from_pdf()`: extraction champs structur√©s
  - Patterns regex pour format marocain

#### backend/utils/
- **encryption.py**: `EncryptionService` avec encrypt/decrypt
- **text_cleaner.py**: Nettoyage et normalisation de texte
- **secrets_checker.py**: Validation des variables d'environnement

## Base de Donn√©es

### Sch√©ma PostgreSQL

#### Table: users
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(120) UNIQUE NOT NULL,
    password_hash VARCHAR(256) NOT NULL,
    first_name VARCHAR(64),
    last_name VARCHAR(64),
    is_approved BOOLEAN DEFAULT FALSE,
    is_admin BOOLEAN DEFAULT FALSE,
    role_id INTEGER REFERENCES roles(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_users_email ON users(email);
```

#### Table: roles
```sql
CREATE TABLE roles (
    id SERIAL PRIMARY KEY,
    name VARCHAR(80) UNIQUE NOT NULL,
    description VARCHAR(255),
    permissions JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### Table: jurisprudence_cases
```sql
CREATE TABLE jurisprudence_cases (
    id SERIAL PRIMARY KEY,
    ref VARCHAR(100) UNIQUE NOT NULL,
    titre VARCHAR(500),
    juridiction VARCHAR(200),
    pays VARCHAR(100),
    ville VARCHAR(100),
    numero_decision VARCHAR(100),
    date_decision DATE,
    numero_dossier VARCHAR(100),
    type_decision VARCHAR(100),
    chambre VARCHAR(100),
    theme VARCHAR(200),
    mots_cles VARCHAR(500),
    base_legale TEXT,
    source VARCHAR(200),
    resume_francais_encrypted TEXT,
    resume_arabe_encrypted TEXT,
    texte_integral_encrypted TEXT,
    pdf_file_path VARCHAR(500),
    created_by INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_cases_ref ON jurisprudence_cases(ref);
CREATE INDEX idx_cases_date ON jurisprudence_cases(date_decision);
CREATE INDEX idx_cases_juridiction ON jurisprudence_cases(juridiction);
```

#### Table: search_history
```sql
CREATE TABLE search_history (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    query_encrypted TEXT NOT NULL,
    results_count INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_search_user_id ON search_history(user_id);
```

### Relations

```
users (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> (N) jurisprudence_cases
  ‚îÇ                         (created_by)
  ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> (N) search_history
  ‚îÇ                         (user_id)
  ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> (1) roles
                           (role_id)
```

### Strat√©gie de Chiffrement

#### Champs Chiffr√©s (Fernet)
- `resume_francais_encrypted`
- `resume_arabe_encrypted`
- `texte_integral_encrypted`
- `query_encrypted` (dans search_history)

#### Champs Non Chiffr√©s (pour recherche)
- `ref`, `titre`, `juridiction`
- `date_decision`, `theme`, `mots_cles`
- `base_legale`, `source`

**Raison**: Balance entre s√©curit√© (contenu sensible chiffr√©) et performance (m√©tadonn√©es searchables).

## API REST

### Endpoints d'Authentification

#### POST /api/auth/register
Inscription d'un nouvel utilisateur.

**Request:**
```json
{
  "email": "user@example.com",
  "password": "SecurePass123",
  "confirmPassword": "SecurePass123",
  "firstName": "Jean",
  "lastName": "Dupont"
}
```

**Response (201):**
```json
{
  "message": "Compte cr√©√© avec succ√®s. En attente de validation.",
  "requiresApproval": true
}
```

#### POST /api/auth/login
Connexion utilisateur.

**Request:**
```json
{
  "email": "user@example.com",
  "password": "SecurePass123"
}
```

**Response (200):**
```json
{
  "message": "Connexion r√©ussie",
  "user": {
    "id": 1,
    "email": "user@example.com",
    "firstName": "Jean",
    "lastName": "Dupont",
    "isAdmin": false
  }
}
```

#### GET /api/auth/me
Informations utilisateur connect√©.

**Response (200):**
```json
{
  "id": 1,
  "email": "user@example.com",
  "firstName": "Jean",
  "lastName": "Dupont",
  "isAdmin": false,
  "isApproved": true
}
```

### Endpoints de Jurisprudence

#### GET /api/cases
Liste pagin√©e des cas.

**Query Parameters:**
- `page` (default: 1)
- `per_page` (default: 20)

**Response (200):**
```json
{
  "cases": [...],
  "total": 2970,
  "page": 1,
  "perPage": 20,
  "totalPages": 149
}
```

#### GET /api/cases/:id
D√©tails d'un cas sp√©cifique.

**Response (200):**
```json
{
  "id": 1,
  "ref": "CAS-2024-001",
  "titre": "Affaire X vs Y",
  "juridiction": "Cour d'Appel de Casablanca",
  "dateDecision": "2024-01-15",
  "resumeFrancais": "...",
  "resumeArabe": "...",
  "texteIntegral": "...",
  ...
}
```

#### POST /api/search
Recherche IA par description texte.

**Request:**
```json
{
  "query": "Litige commercial sur clause contractuelle abusive"
}
```

**Response (200):**
```json
{
  "success": true,
  "similarCases": [
    {
      "id": 42,
      "ref": "CAS-2023-156",
      "titre": "...",
      "similarity": 0.92
    }
  ],
  "analysis": "Analyse globale de l'IA...",
  "recommendations": "Recommandations juridiques...",
  "totalCasesAnalyzed": 50
}
```

#### POST /api/search-stream
Recherche IA avec streaming SSE.

**Request:**
```json
{
  "query": "..."
}
```

**Response (Server-Sent Events):**
```
data: {"type": "progress", "message": "Indexation..."}
data: {"type": "thinking", "message": "R√©flexion en cours..."}
data: {"type": "complete", "result": {...}}
```

### Endpoints d'Import

#### POST /api/batch-import
Import en masse de PDFs (jusqu'√† 200).

**Request:** `multipart/form-data`
- `files[]`: array de fichiers PDF

**Response (200):**
```json
{
  "success": true,
  "processed": 150,
  "failed": 0,
  "details": [...]
}
```

### Codes de Statut HTTP

- **200 OK**: Succ√®s
- **201 Created**: Ressource cr√©√©e
- **400 Bad Request**: Donn√©es invalides
- **401 Unauthorized**: Non authentifi√©
- **403 Forbidden**: Non autoris√©
- **404 Not Found**: Ressource introuvable
- **500 Internal Server Error**: Erreur serveur

## Services

### AIService (ai_service.py)

#### M√©thode: find_similar_cases()

```python
def find_similar_cases(
    case_description: str,
    existing_cases: list
) -> dict:
    """
    Analyse un cas et trouve des pr√©c√©dents similaires.
    
    Args:
        case_description: Description du cas √† analyser
        existing_cases: Liste des cas dans la base
        
    Returns:
        {
            'success': True,
            'similar_cases': [...],
            'analysis': '...',
            'recommendations': '...',
            'similarity_reasons': {...}
        }
    """
```

**Logique:**
1. Indexation des cas (max 50 pour limiter tokens)
2. Construction du prompt bilingue (FR + AR)
3. Requ√™te √† OpenRouter API (Claude 3.5 Sonnet)
4. Parsing de la r√©ponse JSON
5. Matching des r√©f√©rences avec cas complets
6. Retour des r√©sultats structur√©s

**Mod√®le IA:**
- `anthropic/claude-3.5-sonnet`
- Temp√©rature: 0.3 (pr√©cision)
- Max tokens: 3000
- Timeout: 60s

### PDFExtractorService (pdf_extractor.py)

#### M√©thode: extract_case_from_pdf()

```python
def extract_case_from_pdf(pdf_path: str) -> dict:
    """
    Extrait les champs structur√©s d'un PDF juridique.
    
    Args:
        pdf_path: Chemin du fichier PDF
        
    Returns:
        {
            'ref': 'CAS-2024-001',
            'titre': '...',
            'juridiction': '...',
            'resume_francais': '...',
            'resume_arabe': '...',
            ...
        }
    """
```

**Patterns Regex:**
```python
patterns = {
    'ref': r'Ref[:\s]+([^\n]+)',
    'titre': r'Titre[:\s]+([^\n]+)',
    'juridiction': r'Juridiction[:\s]+([^\n]+)',
    'resume_fr': r'R√©sum√© \(en fran√ßais\)[:\s]+(.*?)(?=R√©sum√©|Texte|$)',
    'resume_ar': r'R√©sum√© \(en arabe\)[:\s]+(.*?)(?=Texte|$)',
    ...
}
```

### EncryptionService (encryption.py)

```python
class EncryptionService:
    def __init__(self, key: bytes):
        self.cipher = Fernet(key)
    
    def encrypt(self, text: str) -> str:
        """Chiffre un texte et retourne base64."""
        
    def decrypt(self, encrypted_text: str) -> str:
        """D√©chiffre un texte base64."""
```

**S√©curit√©:**
- Algorithme: Fernet (AES-128 CBC + HMAC)
- Cl√©: 32 bytes g√©n√©r√©e avec `Fernet.generate_key()`
- Encodage: Base64 pour stockage en DB

## S√©curit√©

### Authentification

#### Flask-Login
```python
@login_manager.user_loader
def load_user(user_id):
    return User.query.get(int(user_id))

@login_manager.unauthorized_handler
def unauthorized():
    return jsonify({'error': 'Authentification requise'}), 401
```

#### Protection des Routes
```python
from flask_login import login_required, current_user

@cases_bp.route('/api/cases', methods=['POST'])
@login_required
def create_case():
    if not current_user.is_admin:
        return jsonify({'error': 'Acc√®s refus√©'}), 403
    ...
```

### Protection CSRF

```python
csrf = CSRFProtect(app)

# Exemption pour APIs JSON
csrf.exempt(auth_bp)
csrf.exempt(cases_bp)
csrf.exempt(batch_import_bp)
csrf.exempt(roles_bp)
```

**Note:** En production avec frontend s√©par√©, utiliser tokens CSRF dans headers.

### Gestion des Mots de Passe

```python
from flask_bcrypt import Bcrypt

bcrypt = Bcrypt(app)

# Hashage
password_hash = bcrypt.generate_password_hash(password).decode('utf-8')

# V√©rification
if bcrypt.check_password_hash(user.password_hash, password):
    # Connexion OK
```

### CORS Configuration

```python
CORS(app, 
     supports_credentials=True,
     origins=['http://localhost:5000', 'http://127.0.0.1:5000'])
```

**Production:** Limiter aux domaines autoris√©s uniquement.

### Headers de S√©curit√©

```python
@app.after_request
def add_security_headers(response):
    response.headers['Cache-Control'] = 'no-store, no-cache'
    response.headers['X-Content-Type-Options'] = 'nosniff'
    response.headers['X-Frame-Options'] = 'DENY'
    response.headers['X-XSS-Protection'] = '1; mode=block'
    return response
```

## Performance

### Optimisations Base de Donn√©es

#### Indexes
```sql
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_cases_ref ON jurisprudence_cases(ref);
CREATE INDEX idx_cases_date ON jurisprudence_cases(date_decision);
```

#### Pagination
```python
page = request.args.get('page', 1, type=int)
per_page = 20
cases_query = JurisprudenceCase.query.paginate(
    page=page,
    per_page=per_page,
    error_out=False
)
```

### Cache HTTP

```python
@app.after_request
def add_header(response):
    response.headers['Cache-Control'] = 'no-store, no-cache, must-revalidate'
    response.headers['Pragma'] = 'no-cache'
    response.headers['Expires'] = '0'
    return response
```

**Raison:** Application hautement dynamique avec donn√©es sensibles.

### Gunicorn Workers

```bash
gunicorn --workers 4 \
         --threads 2 \
         --timeout 120 \
         --bind 0.0.0.0:5000 \
         main:app
```

**Formule:** `workers = (2 x CPU_cores) + 1`

## Tests

### Structure de Tests (√Ä Impl√©menter)

```
tests/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ test_auth.py          # Tests authentification
‚îú‚îÄ‚îÄ test_cases.py         # Tests gestion cas
‚îú‚îÄ‚îÄ test_search.py        # Tests recherche IA
‚îú‚îÄ‚îÄ test_import.py        # Tests import PDF
‚îî‚îÄ‚îÄ conftest.py           # Fixtures pytest
```

### Exemple de Test Unitaire

```python
import pytest
from backend.app import app, db
from backend.models.user import User

@pytest.fixture
def client():
    app.config['TESTING'] = True
    app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///:memory:'
    with app.test_client() as client:
        with app.app_context():
            db.create_all()
        yield client
        with app.app_context():
            db.drop_all()

def test_register(client):
    response = client.post('/api/auth/register', json={
        'email': 'test@example.com',
        'password': 'Test123!',
        'confirmPassword': 'Test123!',
        'firstName': 'Test',
        'lastName': 'User'
    })
    assert response.status_code == 201
    assert b'Compte cr' in response.data
```

### Tests d'Int√©gration

```python
def test_full_search_workflow(client, auth):
    # 1. Login
    auth.login()
    
    # 2. Cr√©er un cas (admin)
    response = client.post('/api/cases', json={...})
    assert response.status_code == 201
    
    # 3. Rechercher
    response = client.post('/api/search', json={
        'query': 'Test case description'
    })
    assert response.status_code == 200
    assert 'similar_cases' in response.json
```

## Monitoring et Logs

### Logging Configuration

```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s [%(levelname)s] %(name)s: %(message)s',
    handlers=[
        logging.FileHandler('app.log'),
        logging.StreamHandler()
    ]
)
```

### M√©triques Recommand√©es

- Temps de r√©ponse API
- Nombre de requ√™tes IA par jour
- Taux d'erreur par endpoint
- Utilisation CPU/RAM
- Connexions DB actives

## Maintenance

### Backup Base de Donn√©es

```bash
# Backup
pg_dump $DATABASE_URL > backup_$(date +%Y%m%d).sql

# Restore
psql $DATABASE_URL < backup_20240101.sql
```

### Migration de Donn√©es

Utiliser `migrate_database_safe.py` pour migrations structurelles :

```bash
python migrate_database_safe.py
```

### Rotation Cl√© de Chiffrement

1. G√©n√©rer nouvelle cl√© Fernet
2. D√©chiffrer toutes les donn√©es avec ancienne cl√©
3. Rechiffrer avec nouvelle cl√©
4. Mettre √† jour `ENCRYPTION_KEY`

## Support

Pour toute question technique :
- Documentation: README.md
- D√©ploiement: DEPLOYMENT.md
- Contact: admin syst√®me
